<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" />

  <PropertyGroup>
    <XHarnessAppBundleUrl>https://netcorenativeassets.blob.core.windows.net/resource-packages/external/macos/test-ios-app/System.Numerics.Vectors.Tests.app.zip</XHarnessAppBundleUrl>
  </PropertyGroup>

  <Target Name="Build" Returns="@(XHarnessPackageToTest)" >
    <Error Condition=" '$(BaseOutputPath)' == ''" Text="Not downloading AppBundle because BaseOutputPath property is unset" />
    <DownloadFile SourceUrl="$(XHarnessAppBundleUrl)" DestinationFolder="$(BaseOutputPath)appbundle" SkipUnchangedFiles="True" Retries="5">
      <Output TaskParameter="DownloadedFile" ItemName="DownloadedZippedAppBundle" />
    </DownloadFile>

    <Message Text="Downloaded @(DownloadedZippedAppBundle) for XHarness Test purposes" Importance="High" />

    <Exec Command="tar -xzf @(DownloadedZippedAppBundle)" />

    <ItemGroup>
      <!-- We're not set up currently to build APK files as part of normal builds, so this downloads existing ones for now -->
      <XHarnessAppFolderToTest Include="$(BaseOutputPath)appbundle/System.Numerics.Vectors.Tests.app">
        <Targets>ios-simulator-64</Targets>
      </XHarnessAppFolderToTest>
    </ItemGroup>
  </Target>

</Project>
