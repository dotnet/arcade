<!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. See the LICENSE file in the project root for more information. -->
<Project>  
  <PropertyGroup>
    <DotNetBuildTasksTargetFrameworkSdkDll Condition="'$(DotNetBuildTasksTargetFrameworkSdkDll)' == '' AND '$(MSBuildRuntimeType)' == 'core'">..\tools\netcoreapp2.1\Microsoft.DotNet.Build.Tasks.TargetFramework.Sdk.dll</DotNetBuildTasksTargetFrameworkSdkDll>
    <DotNetBuildTasksTargetFrameworkSdkDll Condition="'$(DotNetBuildTasksTargetFrameworkSdkDll)' == '' AND '$(MSBuildRuntimeType)' != 'core'">..\tools\net472\Microsoft.DotNet.Build.Tasks.TargetFramework.Sdk.dll</DotNetBuildTasksTargetFrameworkSdkDll>
  </PropertyGroup>
  
  <PropertyGroup Condition="$(TargetFramework.Contains('-'))">
    <CustomTargetFrameworkProfile>$(TargetFramework.SubString($([MSBuild]::Add($(TargetFramework.IndexOf('-')), 1))))</CustomTargetFrameworkProfile>
    <_TargetFrameworkWithoutProfile>$(TargetFramework.SubString(0, $(TargetFramework.IndexOf('-'))))</_TargetFrameworkWithoutProfile>
  </PropertyGroup>
 
  <!-- Split $(TargetFramework) (e.g. net45) into short identifier and short version (e.g. 'net' and '45'). -->
  <PropertyGroup Condition="'$(TargetFramework)' != '' and !$(TargetFramework.Contains(',')) and !$(TargetFramework.Contains('+'))">
   <_TargetFrameworkWithoutProfile Condition="'$(_TargetFrameworkWithoutProfile)' == ''">$(TargetFramework)</_TargetFrameworkWithoutProfile>
   <_ShortFrameworkIdentifier>$(_TargetFrameworkWithoutProfile.TrimEnd('.0123456789'))</_ShortFrameworkIdentifier>
   <_ShortFrameworkVersion>$(_TargetFrameworkWithoutProfile.Substring($(_ShortFrameworkIdentifier.Length)))</_ShortFrameworkVersion>
  </PropertyGroup>
  
  <!-- Map short name to long name. See earlier comment for example of how to work with identifiers that are not recognized here. -->
  <PropertyGroup Condition="'$(TargetFrameworkIdentifier)' == ''">
    <TargetFrameworkIdentifier Condition="'$(_ShortFrameworkIdentifier)' == 'netstandard'">.NETStandard</TargetFrameworkIdentifier>
    <TargetFrameworkIdentifier Condition="'$(_ShortFrameworkIdentifier)' == 'netcoreapp'">.NETCoreApp</TargetFrameworkIdentifier>
    <TargetFrameworkIdentifier Condition="'$(_ShortFrameworkIdentifier)' == 'net'">.NETFramework</TargetFrameworkIdentifier>
  </PropertyGroup>

  <!-- Versions with dots are taken as is and just given leading 'v'. -->
  <PropertyGroup Condition="'$(TargetFrameworkVersion)' == '' and '$(_ShortFrameworkVersion)' != '' and $(_ShortFrameworkVersion.Contains('.'))">
    <TargetFrameworkVersion>v$(_ShortFrameworkVersion)</TargetFrameworkVersion>
  </PropertyGroup>

  <!-- Versions with no dots and up to 3 characters get leading 'v' and implicit dots between characters. -->
  <PropertyGroup Condition="'$(TargetFrameworkVersion)' == '' and '$(_ShortFrameworkVersion)' != ''">
    <TargetFrameworkVersion Condition="$(_ShortFrameworkVersion.Length) == 1">v$(_ShortFrameworkVersion[0]).0</TargetFrameworkVersion>
    <TargetFrameworkVersion Condition="$(_ShortFrameworkVersion.Length) == 2">v$(_ShortFrameworkVersion[0]).$(_ShortFrameworkVersion[1])</TargetFrameworkVersion>
    <TargetFrameworkVersion Condition="$(_ShortFrameworkVersion.Length) == 3">v$(_ShortFrameworkVersion[0]).$(_ShortFrameworkVersion[1]).$(_ShortFrameworkVersion[2])</TargetFrameworkVersion>
  </PropertyGroup>

  <Choose>
    <When Condition="$(TargetFramework.Contains('net45'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.5</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net451'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.5.1</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net46'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net461'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.1</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net462'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.2</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net463'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.6.3</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net47'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.7</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net471'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.7.1</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('net472'))">
      <PropertyGroup>
        <TargetingPackNugetPackageId>Microsoft.TargetingPack.NETFramework.v4.7.2</TargetingPackNugetPackageId>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('win8'))">
      <PropertyGroup>
        <TargetFrameworkIdentifier>v8.0</TargetFrameworkIdentifier>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('wpa81'))">
      <PropertyGroup>
        <TargetFrameworkIdentifier>v8.1</TargetFrameworkIdentifier>
      </PropertyGroup>
    </When>
  </Choose>
  <Choose>
    <When Condition="$(TargetFramework.Contains('Windows_NT'))">
      <PropertyGroup>
        <OSGroup>Windows_NT</OSGroup>
        <TargetsWindows>true</TargetsWindows>
        <PackageTargetRuntime>win</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('Unix'))">
      <PropertyGroup>
        <OSGroup>Unix</OSGroup>
        <TargetsUnix>true</TargetsUnix>
        <PackageTargetRuntime>unix</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('Linux'))">
      <PropertyGroup>
        <OSGroup>Linux</OSGroup>
        <TargetsUnix>true</TargetsUnix>
        <TargetsLinux>true</TargetsLinux>
        <PackageTargetRuntime>linux</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('OSX'))">
      <PropertyGroup>
        <OSGroup>OSX</OSGroup>
        <TargetsUnix>true</TargetsUnix>
        <TargetsOSX>true</TargetsOSX>
        <PackageTargetRuntime>osx</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('FreeBSD'))">
      <PropertyGroup>
        <OSGroup>FreeBSD</OSGroup>
        <TargetsUnix>true</TargetsUnix>
        <TargetsFreeBSD>true</TargetsFreeBSD>
        <PackageTargetRuntime>freebsd</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('NetBSD'))">
      <PropertyGroup>
        <OSGroup>NetBSD</OSGroup>
        <TargetsUnix>true</TargetsUnix>
        <TargetsNetBSD>true</TargetsNetBSD>
        <PackageTargetRuntime>netbsd</PackageTargetRuntime>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('WebAssembly'))">
      <PropertyGroup>
        <OSGroup>WebAssembly</OSGroup>
        <TargetsLinux>true</TargetsLinux>
        <TargetsWebAssembly>true</TargetsWebAssembly>
      </PropertyGroup>
    </When>
    <When Condition="$(TargetFramework.Contains('AnyOS'))">
      <PropertyGroup>
        <OSGroup>AnyOS</OSGroup>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <OSGroup>AnyOS</OSGroup>
      </PropertyGroup>
    </Otherwise>
  </Choose>

  <PropertyGroup>
    <RuntimeOS Condition="'$(RuntimeOS)' == ''">win10</RuntimeOS>
  </PropertyGroup>
</Project>
