<!-- Licensed to the .NET Foundation under one or more agreements. The .NET Foundation licenses this file to you under the MIT license. -->
<Project>

  <!--
    Properties:
      RepositoryName                   Current repository name (e.g. 'dotnet/roslyn').
      VisualStudioDropName             Product drop name, e.g. 'Products/$(System.TeamProject)/$(Build.Repository.Name)/$(Build.SourceBranchName)/$(Build.BuildNumber)'
  -->
  
  <PropertyGroup>
    <_VisualStudioBuildTasksAssembly>$(NuGetPackageRoot)microsoft.dotnet.build.tasks.visualstudio\$(MicrosoftDotNetBuildTasksVisualStudioVersion)\tools\net472\Microsoft.DotNet.Build.Tasks.VisualStudio.dll</_VisualStudioBuildTasksAssembly>
  </PropertyGroup>

  <UsingTask TaskName="Microsoft.DotNet.Build.Tasks.VisualStudio.GenerateSpeedometerPropsFile" AssemblyFile="$(_VisualStudioBuildTasksAssembly)" />

  <Target Name="_GenerateSpeedometerPropsFile" BeforeTargets="AfterBuild">
    <Error Condition="('$(VisualStudioDropName)' == '' or '$(RepositoryName)' == '') and '$(OfficialBuild)' == 'true'"
           Text="Properties VisualStudioDropName and RepositoryName must be specified in official build that produces Visual Studio insertion components." />

    <GenerateSpeedometerPropsFile ProductDropName="$(VisualStudioDropName)"
                                  RepositoryName="$(RepositoryName)"
                                  OutputDirectory="$(VisualStudioSetupInsertionPath)SpeedometerInputs"/>
  </Target>
</Project>
