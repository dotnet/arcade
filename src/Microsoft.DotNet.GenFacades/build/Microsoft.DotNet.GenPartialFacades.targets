<Project>
  <PropertyGroup Condition="'$(GenrateTypeForwardsSourceCode)' == 'true' AND '$(IsReferenceAssembly)' != 'true'">
    <!-- Tell ResolveMatchingContract to run and resolve contract to project reference -->
    <ResolveMatchingContract>true</ResolveMatchingContract>
    <FillPartialFacadeDependsOn>
      $(FillPartialFacadeDependsOn);ResolveMatchingContract
    </FillPartialFacadeDependsOn>
  </PropertyGroup>
  
  <PropertyGroup>
    <CompileDependsOn Condition="'$(GenrateTypeForwardsSourceCode)' == 'true' and '$(DesignTimeBuild)' != 'true'">
      FillPartialFacadeUsingTask2;$(CompileDependsOn)
    </CompileDependsOn>
  </PropertyGroup>

  <UsingTask TaskName="GenPartialFacadesTask" AssemblyFile="$(_MicrosoftDotNetGenFacadesTaskDir)Microsoft.DotNet.GenFacades.dll" />

  <Target Name="FillPartialFacadeUsingTask2" DependsOnTargets="$(FillPartialFacadeDependsOn)">  
    
    <PropertyGroup Condition="'$(IsReferenceAssembly)' != 'true'">
      <ReferenceAssembly>%(ResolvedMatchingContract.Identity)</ReferenceAssembly>
      <OutputSourcePath>$(IntermediateOutputPath)\$(AssemblyTitle).Forwards.cs</OutputSourcePath>
      <GenFacadesIgnoreMissingTypes Condition="'$(GenFacadesIgnoreMissingTypes)' == ''">false</GenFacadesIgnoreMissingTypes>
    </PropertyGroup>

    <GenPartialFacadesTask
      ReferencePaths="@(ReferencePath)"
      ReferenceAssembly="$(ReferenceAssembly)"
      CompileFiles="@(Compile)"
      DefineConstants="$(DefineConstants)"
      IgnoreMissingTypes="$(GenFacadesIgnoreMissingTypes)"
      OutputSourcePath="$(OutputSourcePath)"
      SeedTypePreferences="@(SeedTypePreference)"
    />

    <ItemGroup>
      <Compile Condition="Exists($(OutputSourcePath))" Include="$(OutputSourcePath)"/>
    </ItemGroup>
  </Target>
</Project>
