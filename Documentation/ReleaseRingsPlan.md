# Staged release process

## Goal

Today, the release process is all baked into a single release definition, including validation checks, manual steps, etc. 
Also, it requires some pre-work by the PM to download the bits, order them and making sure they are available for the overall
process. With the data in BAR and commands supported by `darc` we can automate some of things.

Also, we would like to introduce the concept of "promotion". In order for a build to be shipped it would need to go
through several **rings**. Each ring has different types of validations. A build is only promoted if it passes all the 
validation checks.

## Release Rings

### Build Ring (starting from any channel that requires a build)

1. Standard build (should take less than 2 hours)
2. Sign produced packages by the build*
3. Signing validation*
4. Symbol publishing to symweb and MSDL
5. Symbol availability validation
6. Publish packages, installers, packages, etc. to dotnet feeds and MyGet
7. **(Future)** source build
*Signing might not be needed in this ring, call is still TBD

**Promotion:** 
1. Contract is valid 
2. Version is coherent
3. Release Team approval

### Candidate Build Validation Ring (Candidate Validation channel)

1. No build required
2. Push packages to nuget-int to validate that nupkgs are well formed
3. VS Insertion
  3.1 VAL Build
4. Upload bits to share drop
  4.1 CTI Validation 

**Promotion:** 
1. Contract is valid 
2. CTI sign off
3. VAL build is green
4. Individual teams sign off
5. Tactics approval

### Staging Ring (Release Staging channel)

1. No build required
2. Create Git Tags
3. Antares: set of zips used to deploy to Azure App Services for the SDK, Runtime and ASP. SDK and Runtime are generated by a 
post-build script. Zips are validated by the ASP team against an App Services test environment
4. Create SDK tarball
5. Mac + Linux signing
6. Create release notes
7. Aggregate checksums
8. Create release metadata

**Promotion:**
1. Contract is valid
2. Each task's validation passes
3. Tactics approve this version

### Final Release/Publish Ring (Publish Release channel)
 
1. No build required
2. Publish and validate to CDN
3. Publish signed bits to blob storage
4. Publish aggregated checksums to blob storage
5. Publish and validate to NuGet
6. Publish and validate NuGet symbols
7. Publish SNAP
8. Publish and validate Linux distributions
9. Antares deployment*
10. Publish and validate Docker
11. Publish signed bits to dot.net
12. Publish release notes and metadata to GitHub
