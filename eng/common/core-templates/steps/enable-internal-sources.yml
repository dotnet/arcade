parameters:
# This is the Azure federated service connection that we log into to get an access token.
- name: nugetFederatedServiceConnection
  type: string
  default: 'dnceng-artifacts-feeds-read'

steps:
- ${{ if and(eq(parameters.runAsPublic, 'false'), ne(variables['System.TeamProject'], 'public'))) }}:
  # If running on dnceng (internal project), just use the default behavior for NuGetAuthenticate.
  # If running on DevDiv, NuGetAuthenticate is not really an option. It's scoped to a single feed, and we have many feeds that
  # may be added. Instead, we'll use the traditional approach (add cred to nuget.config), but use an account token.
  - ${{ if eq(variables['System.TeamProject'], 'internal')) }}:
    - task: NuGetAuthenticate@1
      displayName: 'Authenticate to dnceng internal feeds'
  - ${{ else }}:
    - template: /eng/common/core-templates/steps/get-federated-access-token.yml
      parameters:
        federatedServiceConnection: ${{ parameters.nugetFederatedServiceConnection }}
        outputVariableName: 'dnceng-artifacts-feeds-read-access-token'
    - task: PowerShell@2
      displayName: Setup Private Feeds Credentials (Windows)
      inputs:
        filePath: $(Build.SourcesDirectory)/eng/common/SetupNugetSources.ps1
        arguments: -ConfigFile $(Build.SourcesDirectory)/NuGet.config -Password $(dnceng-artifacts-feeds-read-access-token)
