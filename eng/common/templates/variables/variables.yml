parameters:
  variables: []

variables:
- name: context_internal
  value: ${{ and(ne(variables.runAsPublic, 'true'), ne(variables['System.TeamProject'], 'public'), notIn(variables['Build.Reason'], 'PullRequest')) }}

- ${{ each variable in parameters.variables }}:
  # handle name-value variable syntax
  # example:
  # - name: [key]
  #   value: [value]
  - ${{ if ne(variable.name, '') }}:
    - name: ${{ variable.name }}
      value: ${{ variable.value }}
  
  # handle variable groups
  - ${{ if ne(variable.group, '') }}:
    - group: ${{ variable.group }}

  # handle key-value variable syntax.
  # example:
  # - [key]: [value]
  - ${{ if and(eq(variable.name, ''), eq(variable.group, '')) }}:
    - ${{ each pair in variable }}:
      - name: ${{ pair.key }}
        value: ${{ pair.value }}